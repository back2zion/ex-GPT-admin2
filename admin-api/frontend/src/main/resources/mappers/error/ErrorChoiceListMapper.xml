<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.datastreams.gpt.error.mapper.ErrorChoiceListMapper">

    <!-- L-022: 오류 선택지 목록 조회 -->
    <select id="selectErrorChoiceList" parameterType="com.datastreams.gpt.error.dto.ErrorChoiceListRequestDto" resultType="java.util.Map">
        SELECT 
            C2.LEVEL_N2_SEQ,
            C2.LEVEL_N1_CD,
            C2.LEVEL_N2_CD,
            C2.LEVEL_N2_NM,
            C2.USE_YN,
            C2.CD_SEQ,
            ROW_NUMBER() OVER (PARTITION BY C2.LEVEL_N1_CD ORDER BY C2.CD_SEQ) AS CD_SORT_SEQ,
            COUNT(*) OVER (PARTITION BY C2.LEVEL_N1_CD) AS TOT_CD_CNT
        FROM COM_CD_LV2 C2
        WHERE 1=1
        AND C2.LEVEL_N1_CD = #{levelN1Cd}
        ORDER BY C2.CD_SEQ
    </select>

    <!-- 오류 선택지 총 개수 조회 -->
    <select id="selectErrorChoiceCount" parameterType="String" resultType="Integer">
        SELECT COUNT(*)
        FROM COM_CD_LV2 C2
        WHERE 1=1
        AND C2.LEVEL_N1_CD = #{levelN1Cd}
    </select>

</mapper>
