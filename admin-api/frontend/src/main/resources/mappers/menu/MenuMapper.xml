<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.datastreams.gpt.menu.mapper.MenuMapper">

    <!-- L-007: 사용자별 메뉴 목록 조회 -->
    <select id="selectUserMenus" parameterType="string" resultType="com.datastreams.gpt.menu.dto.MenuInfoDto">
        SELECT 
            MENU_ID as menuId,
            MENU_NM as menuNm,
            MENU_URL as menuUrl,
            PARENT_MENU_ID as parentMenuId,
            MENU_LEVEL as menuLevel,
            SORT_ORDER as sortOrder,
            USE_YN as useYn
        FROM MENU_INFO
        WHERE 1=1
        AND USR_ID = #{usrId}
        AND USE_YN = 'Y'
        ORDER BY MENU_LEVEL, SORT_ORDER
    </select>

    <!-- L-007: 사용자별 메뉴 목록 조회 (getUserMenus) -->
    <select id="getUserMenus" parameterType="string" resultType="com.datastreams.gpt.menu.dto.MenuInfoDto">
        SELECT 
            MENU_ID as menuId,
            MENU_NM as menuNm,
            MENU_URL as menuUrl,
            PARENT_MENU_ID as parentMenuId,
            MENU_LEVEL as menuLevel,
            SORT_ORDER as sortOrder,
            USE_YN as useYn
        FROM MENU_INFO
        WHERE 1=1
        AND USR_ID = #{usrId}
        AND USE_YN = 'Y'
        ORDER BY MENU_LEVEL, SORT_ORDER
    </select>

    <!-- L-013: 메뉴별 추천 질의 조회 -->
    <select id="selectRecommendedQuestions" parameterType="long" resultType="com.datastreams.gpt.menu.dto.RecommendedQuestionDto">
        WITH ETL_DAT
        AS
        (
            SELECT #{menuId} AS MENU_ID /* {MENU_ID}  BIGINT : 메뉴 아이디 */
            WHERE 1=1
        )	
        SELECT Q.RCM_QUES_SEQ as rcmQuesSeq, Q.RCM_QUES_NM as rcmQuesNm
        FROM ETL_DAT T 
        INNER JOIN MENU_RCM_QUES Q ON T.MENU_ID = Q.MENU_ID
        WHERE 1=1
        ORDER BY Q.RCM_QUES_SEQ
    </select>

</mapper>